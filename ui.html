<!-- <link rel="stylesheet" href="https://static.figma.com/api/figma-extension-api-0.0.1.css"> -->
<style>
  :root {
    color-scheme: dark light;
  }

  body {
    font-family: Inter, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif;
    line-height: 1.6;
    font-size: 1.1rem;

    height: 600px;
  }
</style>



<h2>Bar Chart Sample</h2>
<p>
  Values:
  <input id="textbox" value="1, 3, 10, 28, 41, 87, 100, 114, 94, 68, 50, 23, 9, 3, 1">
</p>
<b id="errors"></b>
<p><button id="bar-chart">Create Bar Chart</button></p>

<button id="color-scheme">Detect colour scheme</button>

<button id="export-palette">Export styles to colour palette</button>

<div>
  <form id="add-color-form">
    <input type="text" name="color_name">
    <input type="color" name="picked_color">
    <button type="submit">Add Colour</button>
  </form>
</div>

<br />
<br />
<button id="create-palette">Create colour palette</button>
<br />
<br />

<script>
  document.getElementById('add-color-form').addEventListener('submit', (evt) => {
    evt.preventDefault()

    // color_name
    // picked_color
    const formData = dataFromForm(evt.target)

    console.log({ formData })
  })

  document.getElementById('create-palette').addEventListener('click', (evt) => {
    const colourScheme = getColourScheme()

    parent.postMessage({
      pluginMessage: {
        type: 'create-palette',
        data: {
          paletteName: 'Tinacious Design',
          count: 12,
          colourScheme,
        },
      }
    }, '*')
  })

  document.getElementById('export-palette').addEventListener('click', (evt) => {
    parent.postMessage({
      pluginMessage: {
        type: 'export-palette',
        data: {},
      }
    }, '*')
  })

  document.getElementById('color-scheme').addEventListener('click', (evt) => {
    const colourScheme = getColourScheme()

    console.log({ colourScheme })
  })

  document.getElementById('bar-chart').addEventListener('click', (evt) => {
    const text = document.querySelector('#textbox').value

    let numbers = text.split(',').map(x => +x)
    if (numbers.length < 2) {
      showError('Error: Must have at least two values');
      return
    }
    if (numbers.some(x => isNaN(x))) {
      showError('Error: All values must be numbers');
      return
    }

    parent.postMessage({
      pluginMessage: {
        type: 'graph',
        data: numbers,
      }
    }, '*')
  })

  showError = errorMessage => {
    document.querySelector('#errors').textContent = errorMessage
  }


  /**
   * Gets the user's preferred colour scheme. We can use this to generate a dynamic background colour, if necessary
   * @returns 'light' | 'dark'
   */
  function getColourScheme() {
    return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
  }

  function dataFromForm(formElement) {
    const formData = new FormData(formElement)
    return formData.entries()
  }
</script>