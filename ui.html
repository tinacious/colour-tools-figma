<link rel="stylesheet" href="https://static.figma.com/api/figma-extension-api-0.0.1.css">
<style>
  /* :root {
    color-scheme: dark light;
  } */
   /* Shades generated for #1d1d26 with: https://colour-tools.pages.dev/shades */
  :root {
    --black: rgb(0, 0, 0);
    --grey_50: rgb(11, 11, 15);
    --grey_100: rgb(22, 22, 29);
    --grey_200: rgb(44, 44, 58);
    --grey_300: rgb(66, 66, 87);
    --grey_400: rgb(88, 88, 116);
    --grey_500: rgb(110, 110, 145);
    --grey_600: rgb(139, 139, 167);
    --grey_700: rgb(168, 168, 189);
    --grey_800: rgb(197, 197, 211);
    --grey_900: rgb(226, 226, 233);
    --grey_950: rgb(241, 241, 244);
    --white: rgb(255, 255, 255);
  }

  body {
    font-family: Inter, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif;
    line-height: 1.6;
  }

  .tabs {
    background: var(--grey_900);
    display: flex;
    padding: 10px 10px 0;
    gap: 1em;
    margin-bottom: 16px;
  }

  .tab {
    padding: 6px 10px;
    color: #ff3399;
    text-decoration: none;
    background: var(--grey_950);
    border: 1px solid var(--grey_800);
    border-bottom: 0;
  }

  .tab--active {
    background: white;
    color: black;
    font-weight: 700;
    cursor: default;
  }

  .flex {
    display: flex;
  }

  .text-center {
    text-align: center;
  }

  .form-section {
    margin: 14px 0;
  }

  .button-layout {
    display: flex;
    gap: 0.5em;
  }

  .add-color-form {
    display: flex;
    align-items: center;
    gap: 0.5em;
  }

  /* .form-field {

  }

  .form-label {
    font-weight: 700;
    display: block;
  } */

  .swatches {
    display: flex;
    flex-wrap: wrap;
  }

  .swatch {
    width: 20%;
    width: 16.666667%;
    height: 80px;
    padding: 6px;
    box-sizing: border-box;
  }

  .swatch__label {
    background: black;
    color: white;
    padding: 0.25em 0.5em;
    display: inline-block;
    font-size: 0.7rem;
  }
</style>

<script type="module">
  import { createApp } from 'https://unpkg.com/petite-vue@0.4.1/dist/petite-vue.es.js?module'

  const getDefaultColour = () => getColourScheme() === 'dark' ? '#000000' : '#FFFFFF'

  createApp({
    activeTab: 'palettes',

    paletteName: '',

    currentColorName: '',
    currentColorHex: getDefaultColour(),

    // colors: [],

    // test colour palette
    colors: [
      { name: "pink", hex: "#ff3399" },
      { name: "blue", hex: "#33d5ff" },
      { name: "grey", hex: "#b3b3d4" },
      { name: "green", hex: "#00d364" },
      { name: "purple", hex: "#cc66ff" },
      { name: "yellow", hex: "#ffcc66" },
      { name: "turquoise", hex: "#00ced1" },
      { name: "midnight-sky", hex: "#1d1d26" },
      { name: "overcast-sky", hex: "#c8c8d5" },
      { name: "tangerine", hex: "#ffaa00" },
      { name: "red", hex: "#f10f69" }
    ],

    addColor() {
      if (!this.currentColorName) {
        alert('colour name required')
        return
      }

      this.colors.push({
        name: this.currentColorName,
        hex: this.currentColorHex,
      })

      this.currentColorName = ''
      this.currentColorHex = getDefaultColour()
    },

    resetPalette() {
      this.colors = []
    },

    /**
     * Create a colour palette from the picked colours
     */
    createColorPalette() {
      if (!this.colors.length) {
        alert('must add at least 1 colour to generate a palette')
        return
      }

      const colourScheme = getColourScheme()

      const paletteName = this.paletteName.toString()
      if (!paletteName) {
        alert('must name the colour palette')
        return
      }

      const colours = this.colors.map((color) => ({
        name: color.name,
        hex: color.hex,
      }))

      parent.postMessage({
        pluginMessage: {
          type: 'create-palette',
          data: {
            paletteName,
            colourScheme,
            colours,
          },
        }
      }, '*')
    },
  }).mount()


  /* document.getElementById('create-palette').addEventListener('click', (evt) => {
    const colourScheme = getColourScheme()

    parent.postMessage({
      pluginMessage: {
        type: 'create-palette',
        data: {
          paletteName: 'Tinacious Design',
          count: 12,
          colourScheme,
          colours: this.colors,
        },
      }
    }, '*')
  }) */

  /* document.getElementById('export-palette').addEventListener('click', (evt) => {
    parent.postMessage({
      pluginMessage: {
        type: 'export-palette',
        data: {},
      }
    }, '*')
  }) */

  const showError = errorMessage => {
    document.querySelector('#errors').textContent = errorMessage
  }
  document.getElementById('bar-chart').addEventListener('click', (evt) => {
    const text = document.querySelector('#textbox').value

    let numbers = text.split(',').map(x => +x)
    if (numbers.length < 2) {
      showError('Error: Must have at least two values');
      return
    }
    if (numbers.some(x => isNaN(x))) {
      showError('Error: All values must be numbers');
      return
    }

    parent.postMessage({
      pluginMessage: {
        type: 'graph',
        data: numbers,
      }
    }, '*')
  })


  /**
   * Gets the user's preferred colour scheme. We can use this to generate a dynamic background colour, if necessary
   * @returns 'light' | 'dark'
   */
  function getColourScheme() {
    return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
  }

  function dataFromForm(formElement) {
    const formData = new FormData(formElement)
    return formData.entries()
  }
</script>

<div v-scope>
  <div class="tabs">
    <a href="#" class="tab" @click="activeTab = 'palettes'" :class="{ 'tab--active': activeTab === 'palettes'}">
      Colour Palettes
    </a>
    <a href="#" class="tab" @click="activeTab = 'shades'" :class="{ 'tab--active': activeTab === 'shades'}">
      Shades
    </a>
  </div>

  <div v-if="activeTab === 'palettes'">
    <h2>Add colour</h2>

    <h3>Palette Name</h3>
    <div class="form-section">
      <input type="text" v-model="paletteName" placeholder="Palette name" autofocus>
    </div>
  
    <h3>Add colour</h3>
    <form id="add-color-form" class="add-color-form" @submit.prevent="">
      <input type="text" placeholder="Colour name" name="color_name" v-model="currentColorName">
      <input type="color" name="picked_color" v-model="currentColorHex">
      <input type="text" name="picked_color" v-model="currentColorHex">
      <button type="submit" @click="addColor">Add Colour</button>
    </form>
  
    <div v-if="colors.length" class="swatches form-section">
      <div v-for="color in colors" class="swatch" :style="{ background: color.hex }">
        <span class="swatch__label">{{color.name}}</span>
      </div>
    </div>
    <div v-if="colors.length" class="form-section button-layout">
      <button @click="createColorPalette">Create Palette</button>
      <button @click="resetPalette">Reset</button>
    </div>
  
    <div v-if="!colors.length">
      <p class="text-center form-section">No colours yet</p>
    </div>
  </div>

  

  <!-- <hr />

  <button>Export as JSON</button> -->
</div>


<!-- <button id="export-palette">Export styles to colour palette</button> -->
